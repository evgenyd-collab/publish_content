# Настройка GitHub Webhook для автоматического обновления

## Шаг 1: Установка зависимостей

```powershell
pip install flask
```

## Шаг 2: Запуск webhook сервера

### Вариант A: Локальный запуск (только для тестирования)

```powershell
python webhook_server.py
```

### Вариант B: Запуск с доступом из интернета

Для работы webhook из GitHub нужен публичный URL. Есть несколько вариантов:

#### Вариант B1: Использование ngrok (рекомендуется для тестирования)

1. Скачайте ngrok: https://ngrok.com/download
2. Запустите ngrok:
   ```powershell
   ngrok http 5000
   ```
3. Скопируйте URL (например: `https://abc123.ngrok.io`)
4. Используйте этот URL в настройках webhook

#### Вариант B2: Использование облачного сервиса

Разместите скрипт на сервере с публичным IP или используйте сервисы типа:
- Heroku
- Railway
- Render
- DigitalOcean

## Шаг 3: Настройка webhook в GitHub

1. Откройте репозиторий на GitHub: https://github.com/evgenyd-collab/publish_content
2. Перейдите в **Settings** → **Webhooks** → **Add webhook**
3. Заполните форму:
   - **Payload URL**: `http://ваш-ip:5000/webhook` или `https://ваш-ngrok-url.ngrok.io/webhook`
   - **Content type**: `application/json`
   - **Secret** (опционально): создайте случайную строку и установите в переменную окружения `WEBHOOK_SECRET`
   - **Which events**: выберите **Just the push event**
   - **Active**: включено
4. Нажмите **Add webhook**

## Шаг 4: Проверка работы

1. Запустите webhook сервер:
   ```powershell
   python webhook_server.py
   ```

2. Сделайте тестовый push в репозиторий:
   ```powershell
   git commit --allow-empty -m "Test webhook"
   git push origin master
   ```

3. В консоли webhook сервера должно появиться сообщение о получении события и обновлении.

## Шаг 5: Автозапуск webhook сервера

### Вариант A: Через планировщик задач Windows

1. Откройте Планировщик задач (Task Scheduler)
2. Создайте новую задачу:
   - **Триггер**: При входе в систему
   - **Действие**: Запустить программу
   - **Программа**: `python`
   - **Аргументы**: `C:\texts\webhook_server.py`
   - **Рабочая папка**: `C:\texts`

### Вариант B: Через ярлык в автозагрузке

Создайте ярлык с командой:
```
python C:\texts\webhook_server.py
```
И поместите в папку автозагрузки (Win+R → `shell:startup`)

## Безопасность

1. **Используйте секрет webhook** для защиты от несанкционированных запросов
2. **Ограничьте доступ** к серверу через firewall
3. **Используйте HTTPS** (через ngrok или reverse proxy)

## Проверка работоспособности

Откройте в браузере:
- `http://localhost:5000/health` - проверка статуса
- `http://localhost:5000/` - информация о сервисе

## Устранение проблем

### Проблема: Webhook не получает события

1. Проверьте, что сервер запущен и доступен
2. Проверьте настройки webhook в GitHub (должен быть статус "Delivered")
3. Проверьте firewall - порт 5000 должен быть открыт

### Проблема: Ошибка при git pull

1. Убедитесь, что в репозитории нет незакоммиченных изменений
2. Проверьте права доступа к папке `C:\texts`
3. Проверьте, что Git настроен правильно

### Проблема: Сервер не запускается

1. Проверьте, что Flask установлен: `pip list | findstr flask`
2. Проверьте, что порт 5000 свободен: `netstat -an | findstr 5000`
3. Запустите с правами администратора

